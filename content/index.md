# 三叶互联商业计划书
## 一、项目概述  
`三叶互联`项目旨在帮助中国大陆地区的**国际版**MC玩家发现服务器，并且快速联机。  

该项目并不是一个单一的软件，而是通过以下构件打造的一个完整的，全新的 MC 游戏生态格局：  
1. 定制的启动器客户端，下文简称为**三叶启动器**  
2. 用户访问的门户网页，下文简称为**三叶互联网站**  
3. 服务器后端实例监控程序，下文简称为 **IM (Instance Monitor)**  
4. 改造后的游戏面板 WebUI 控制台，下文简称为**游戏面板**  
  
## 二、服务流程  
### 1. 联机流程  
![服务流程——联机](https://pic.kiss1314.top/d/LeavesResource/webImage/20250311185328.png)

### 2. 开服流程  
![服务流程——开服](https://pic.kiss1314.top/d/LeavesResource/webImage/20250311190156.png)

## 三、产品解构  
### 1. 三叶互联网站  
#### 功能  
##### 1. 项目宣发入口  
网站首页进行项目的亮点宣传，帮助用户快速了解项目，并引导用户下载咱们的三叶启动器。  
##### 2. 联机大厅
网站集成联机大厅页面，类似于MC 百科的[“找服玩”页面](https://play.mcmod.cn/) ，但是底层原理和功能有根本的区别：  

|    功能\品牌     |             MC 百科              |             三叶互联网站             |
| :----------: | :----------------------------: | :----------------------------: |
|    发现服务器     |           靠服主自发手动上传            |        和各大IDC厂商合作，自动抓取         |
|   获取实时在线人数   |              脚本爬取              | 对接各大面板，IM（服务器后端实例监控程序）自动获取实例信息 |
|   获取服务器类型    |             服主手动填              |       对接各大面板，IM自动获取实例信息        |
|    加入服务器     | 玩家从网盘手动下载客户端所需文件，或者加入服主提供的 Q 群 |          对接三叶启动器，一键加入          |
| 获取服务器具体有哪些模组 |              ✖不支持              |          ✅IM自动获取实例信息           |
| 获取服务器在线玩家名单  |             ✖无法获取              |          ✅IM自动获取实例信息           |
|   获取服务器规则    |             ✖无法获取              |          ✅IM自动获取实例信息           |
|  获取服务器硬件配置   |             ✖无法获取              |          ✅IM自动获取实例信息           |
|     可扩展性     |             ✖不可能扩展             |       后期升级 IM，几乎能得到任何信息✅       |

##### 3. 开服订单  
用户能在网站上下单租用游戏云服务器，网站根据订单自动分配实例到受控端，亦或对接上游厂商，然后把服务器信息呈现在网站，反馈给用户。之后用户可以前往游戏面板管理服务器。    

#### 技术实现  
由于网站用到的财务系统和将来可能集成的游戏面板几乎都是用 `PHP` 开发的，网站主体应当采用 `PHP` 接续开发。
##### 1. 宣发 UI  
二改 PHP 源码，美化 UI ，尤其注意去掉冗余元素，保留清爽、现代化的游戏云风格。

##### 2. 财务主控系统  
> [!note]
> 财务主控系统处理用户支付宝或微信支付的订单，然后根据订单自动在物理机上分配对应配置的实例。  

可以复用开源的[智简魔方](https://www.idcsmart.com/business.html) 或者 [Prokvm](https://license.xmbillion.com/product/index/prokvm) 代码，实现完备的财务主控系统。  

##### 3. 联机大厅
联机大厅需要通过 API 与 IM 通信，从而自动获取实例信息。  
三叶互联网页端的联机大厅将作为一个“联机数据中心”，他汇总所有 IM 传来的实例信息并且作出处理，最后以指定形式呈现在网页上。  
网站联机大厅和 IM 的关系可能如下：  
![](https://pic.kiss1314.top/d/LeavesResource/webImage/20250312152424.png)


### 2. 三叶启动器  
#### 1. 打造独立启动器品牌  
##### 功能：  
除了要实现市面上其他启动器的基础功能外，可以考虑加入下面这些功能，以此成为 PCL2 等其他第三方启动器的上位替代：  
**完备的资源管理界面：**  
- [x] 模组管理
- [x] 存档管理
- [x] 截图管理
- [x] 光影管理
- [x] 材质&&资源包管理
这个功能大多数第三方启动器还没有，在 PCL2 的 [Issue #4770 提案](https://github.com/Hex-Dragon/PCL2/pull/4770)中有人试图实现：  
![某位开源作者自制的社区版PCL启动器](https://pic.kiss1314.top/d/LeavesResource/webImage/20250311200206.png)

但不知何故，作者龙猫的反响却很冷淡  
![龙猫的回复](https://pic.kiss1314.top/d/LeavesResource/webImage/20250311200044.png)

##### 技术实现：  
启动器完全可以基于市面上其他启动器二改，可选项：  
- **modrinth 启动器**  
  优势：  
    - 采用 Rust 编写，更好的跨平台支持度，更高的性能。  
    - 完全开源。完备的社区沉淀。  
    - 集成了完备的 API，实现模组处理的功能会更轻松。  

  缺陷：  
    - Rust 上手难度高，学习曲线陡峭。  
    - 社区沉淀主要在海外，大量英文阅读需求。  

- **PCL2 启动器**  
  优势：  
    - 功能简单，代码较易于理解。  
    - 软件轻量，集成在整合包里分发更简单。  
    - 也基本实现了 modrinth API 实践。  
    - 国内有很高的知名度，二改发行更容易被人接受。  

  缺陷：  
    - 有部分代码闭源。  
    - .NET 开发，仅仅针对 Windows  


#### 2. 联机大厅和一键联机  
##### 功能：  
在客户端里也同样实现网页中的[[#2. 联机大厅|联机大厅]]页面，用户可以在里面发现各种服务器。  
不同的是，客户端里可以直接点“加入服务器”按钮一键加入服务器，三叶启动器会自动帮用户配置好所需的文件，而无需自己配置模组的繁琐步骤。  
##### 技术实现：  
###### 1. 联机大厅功能  
这一部分需要自己开发联机大厅的 UI。  
抓取数据方面，从三叶互联网站抓取网站后端汇总好的大厅数据，呈现在启动器 UI 里。  

###### 2. 一键联机功能  
> 这是项目的核心难点。  

首先，需要从 IM 获取三个信息：  
- 服务器实例的联机 ip 地址
- 服务器的游戏版本，如果是模组服，还需要知道模组加载器类型。  
- 如果是模组服，还需要知道服务器的模组列表。  
这个可以通过 IM 提供的 API 获取。  

抓到这些信息以后，要做的事情如下：  
1. 帮用户装好游戏环境（对应版本的游戏，如果是模组服，还要装好对应版本的模组加载器）  
   这一步不难，启动器应该会支持传参。  
2. 帮用户装好对应的**客户端版本的**模组。  
   这一步涉及服务端模组转客户端版本，要实现需要充分阅读 modrinth 源码和其他开源社区的实现，还是有难度的。  
3. 帮用户填上服务器 ip，然后启动游戏。  
   这一步很简单，我自制的启梦小镇整合包都已经实现了。  

#### 3. 下单服务器  
>[!caution]
> 开源协议限制，在客户端上实现订单功能还要考虑法律风险，这个功能很可能会弃用，开发优先级会很低  
##### 功能：  
用户能直接在启动器内下单服务器。  
目前更倾向于引导用户到三叶互联网站下单服务器。  

##### 技术实现：  
技术上要实现直接在启动器下单游戏云实例，无非两种方式：  
###### 方式1： 重新开发客户端版本的财务主控系统  
让用户在启动器内也能完成下单购买的逻辑，然后对接到服务器的受控端分配游戏实例。客户端处完成支付回调。  
###### 方式2： 客户端仅仅收发订单数据，财务主控仍然交给网站  
通过 API 和三叶互联网站的财务主控系统通信，客户端仅作为展示订单数据用。这样做，用户在体验上也和方式1 没什么区别，但是要考虑安全性问题。  


### 3. IM (Instance Monitor)  
服务器后端实例监控程序（ IM ）分布部署在各个厂商的游戏面板所在的物理机上，是联机大厅数据的提供者。  
技术上，由于工作在服务器，且有高并发需求，可以考虑使用 go 开发。  
IM 的主要职能如下：  
#### 1. 抓取游戏面板实例信息  
##### 功能：  
IM 安装在各种游戏面板受控端，从游戏实例处能获得几乎所有需要的数据。  
其中一些关键的数据如下：  
- 服务器实例的联机 ip 地址
- 服务器的游戏版本，如果是模组服，还需要知道模组加载器类型。  
- 如果是模组服，还需要知道服务器的模组列表。  
- 服务器实时在线人数  
- 服务器名称  
- 服务器硬件配置
- ......

##### 技术实现：  
首先是得至少开发两套 API 接口，来对接目前最有名的两个开源面板：  
1. [翼龙游戏面板：Pterodactyl-China](https://pterodactyl.top/)  
2. [MCSM 游戏面板](https://mcsmanager.com/)  
这一步不会很难，因为两者都有完备的 API 开发文档和接口文档。  
抓取到需要的实例信息后，可以在本地维护一个动态数据库或者存在 RAM 直接和三叶互联网站交互。  


#### 2.  与三叶互联网站后端通信  
##### 功能：  
把自己抓取到的数据通过 API 传给三叶互联网站。  

##### 技术实现：  
开发一套 API 接口，实时的把数据传给三叶互联网站。  

### 4. 游戏面板
这个面板和项目的主线功能关系不大，开发难度也很低，但是也是盈利创收的关键一环。  
#### 承接游戏云业务
我们完全可以直接二改以下两个开源面板其中之一即可：  
1. [翼龙游戏面板：Pterodactyl-China](https://pterodactyl.top/)  
2. [MCSM 游戏面板](https://mcsmanager.com/)  

技术上，在二改面板的过程中，也能加深对面板机制的理解，从而更好的开发 IM 程序。  

